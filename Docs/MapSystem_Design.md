# 맵 시스템 기획 문서

**프로젝트**: MatchBattle
**버전**: 1.1 (선택 시스템)
**작성일**: 2025-12-22 (수정)
**관련 문서**:
- [GameDesign.md](GameDesign.md) - 게임 전체 설계
- [CombatSystem_Design.md](CombatSystem_Design.md) - 전투 시스템

---

## 📋 목차

1. [시스템 개요](#-시스템-개요)
2. [맵 구조](#-맵-구조)
3. [스테이지 타입](#-스테이지-타입)
4. [조우 풀 시스템](#-조우-풀-시스템)
5. [진행 시스템](#-진행-시스템)
6. [UI/UX](#-uiux)
7. [MVP 범위](#-mvp-범위)
8. [플레이 예시](#-플레이-예시)
9. [밸런싱 고려사항](#-밸런싱-고려사항)
10. [향후 확장](#-향후-확장)

---

## 🎯 시스템 개요

### 핵심 콘셉트
**스테이지 선택 시스템** - 스테이지 완료 시 1-3개의 다음 스테이지 선택지 중 선택

```
게임 루프:
스테이지 완료 → 보상 선택 → 다음 스테이지 선택지 (1-3개 카드) → 선택 → 반복 → 보스 클리어
```

### 디자인 목표
- 전략적 선택: 제시된 선택지 중 최선의 경로 선택
- 리스크/리워드: 엘리트 vs 일반 전투, 상점 vs 휴식
- 빠른 진행: 맵 화면 없이 선택 후 즉시 진입
- 리플레이성: 매 런마다 다른 선택지 트리
- 간결함: 단순하고 직관적인 흐름

---

## 🗺️ 맵 구조

### 기본 구조 (MVP)

```
트리 구조 선택 시스템:

Stage 1: ⚔️ 전투 (시작)
            ↓ (1-3개 선택지)
Stage 2: ⚔️ / 🛒 / ⚔️
            ↓ (각각 1-3개 선택지)
Stage 3: ⚔️ / 💤 / ⚔️ / 💀
            ↓
         ...
            ↓ (1개 선택지)
Stage 7: 👹 보스 (종료)

- 각 스테이지 완료 시 1-3개의 다음 스테이지 선택지 제시
- 플레이어가 선택 → 즉시 해당 스테이지 진입
- Stage 6 → Stage 7 (보스)는 1개만 (필수 진행)
```

### 선택지 구조

```
단계        선택지 개수    설명
Stage 1     -            시작 전투 (자동 진입)
Stage 2-5   1-3개        랜덤 생성
Stage 6     1-3개        후반 전투
Stage 6→7   1개          보스로 필수 진행
Stage 7     -            보스 (런 종료)

총 7단계, 런마다 경로 상이
```

### 맵 생성 규칙

```
1. 트리 생성 방식
   - Stage 1: Combat 고정
   - Stage 2-6: 각 노드가 1-3개의 다음 노드 생성
   - Stage 7: Boss 고정, 다음 노드 없음

2. 스테이지 타입 결정
   - 확률 기반 랜덤 선택
   - 단계별 출현 제한 (예: Elite는 Stage 4+)

3. 선택지 개수
   - 랜덤 1-3개
   - 보스 직전은 1개로 고정
```

---

## 📍 스테이지 타입

### 1. 전투 스테이지 (Combat) ⚔️

```
설명: 적과 전투
보상: 블록/유물/골드/회복 중 선택

일반 전투:
- 적 1-2체
- 표준 보상

출현 확률: 60%
```

### 2. 엘리트 스테이지 (Elite) 💀

```
설명: 강력한 적과 전투
보상: 희귀 블록/유물 획득 확률 증가

엘리트 전투:
- 강화된 적 1체 또는 다수 적
- 더 좋은 보상

출현 확률: 15%
출현 조건: Stage 4 이후
```

### 3. 상점 스테이지 (Shop) 🛒

```
설명: 골드로 아이템 구매

판매 품목:
- 블록 추가 (10-30 골드)
- 유물 구매 (50-100 골드)
- HP 회복 (15 골드 = 10 HP)
- 블록 제거 (20 골드)

출현 확률: 10%
```

### 4. 휴식 스테이지 (Rest) 💤

```
설명: 휴식으로 회복

선택지:
1. 휴식: HP 30% 회복
2. 단련: 랜덤 블록 1개 강화 (공격/방어 +2)

출현 확률: 10%
```

### 5. 이벤트 스테이지 (Event) ❓

```
설명: 랜덤 이벤트 발생

예시 이벤트:
1. 신비한 상자
   - 열기: 랜덤 유물 획득 (50%)
   - 무시: 아무 일 없음

2. 수상한 상인
   - HP 10 지불 → 희귀 블록 획득
   - 거절 → 골드 +10

3. 버려진 제단
   - 기도: 랜덤 버프/디버프
   - 무시: 아무 일 없음

출현 확률: 5%
```

### 6. 보스 스테이지 (Boss) 👹

```
설명: 스테이지 최종 보스

특징:
- 강력한 보스 1체
- 승리 시 스테이지 클리어
- 특별 보상 (희귀 유물 확정)

출현: Stage 7 고정
```

### 스테이지 타입 분포 (MVP)

```
┌──────────┬──────┬─────────────┐
│ 스테이지 │ 확률 │ 층 제한     │
├──────────┼──────┼─────────────┤
│ 전투 ⚔️  │ 60%  │ 없음        │
│ 엘리트 💀│ 15%  │ Stage 4+    │
│ 상점 🛒  │ 10%  │ 없음        │
│ 휴식 💤  │ 10%  │ 없음        │
│ 이벤트 ❓│ 5%   │ 없음        │
└──────────┴──────┴─────────────┘

보스 👹: Stage 7 고정
```

---

## ⚔️ 조우 풀 시스템

### 개념

각 스테이지 레벨마다 **미리 정의된 전투 조우 풀**이 존재합니다. 플레이어가 해당 스테이지에 진입하면, 풀에서 **랜덤하게 하나의 조우**를 선택하여 전투가 시작됩니다.

```
조우(Encounter) = 적 배치 정보
- 4개의 고정 슬롯 (Slot 0-3)
- 각 슬롯은 비어있거나 적이 배치됨
- 슬롯 0: 가장 왼쪽/전방
- 슬롯 3: 가장 오른쪽/후방
```

### 데이터 구조

#### EncounterData (개별 조우)

```csharp
[CreateAssetMenu(fileName = "Encounter", menuName = "Data/Encounter")]
public class EncounterData : ScriptableObject
{
    public string encounterName;        // 조우 이름 (예: "슬라임 단독")

    // 4개의 고정 슬롯 (null 허용)
    public EnemyData enemySlot0;        // 슬롯 0 (전방 왼쪽)
    public EnemyData enemySlot1;        // 슬롯 1
    public EnemyData enemySlot2;        // 슬롯 2
    public EnemyData enemySlot3;        // 슬롯 3 (후방 오른쪽)
}
```

#### EncounterPool (스테이지별 조우 풀)

```csharp
[CreateAssetMenu(fileName = "EncounterPool", menuName = "Data/EncounterPool")]
public class EncounterPool : ScriptableObject
{
    public string poolName;             // 풀 이름 (예: "Stage 2 - Normal")
    public int stageNumber;             // 스테이지 번호 (1-7)
    public StageType encounterType;     // Combat(일반) or Elite(엘리트)

    public List<EncounterData> encounters;  // 조우 리스트
}
```

### 조우 예시

#### 예시 1: 슬라임 단독 (Stage 1 - Normal)

```
encounterName: "슬라임 단독"

┌──────┬──────┬──────┬──────┐
│ 슬롯0 │ 슬롯1 │ 슬롯2 │ 슬롯3 │
├──────┼──────┼──────┼──────┤
│ 슬라임│  -   │  -   │  -   │
└──────┴──────┴──────┴──────┘

enemySlot0: Slime
enemySlot1: null
enemySlot2: null
enemySlot3: null
```

#### 예시 2: 고블린 2마리 (Stage 2 - Normal)

```
encounterName: "고블린 듀오"

┌──────┬──────┬──────┬──────┐
│ 슬롯0 │ 슬롯1 │ 슬롯2 │ 슬롯3 │
├──────┼──────┼──────┼──────┤
│ 고블린│  -   │  -   │ 고블린│
└──────┴──────┴──────┴──────┘

enemySlot0: Goblin
enemySlot1: null
enemySlot2: null
enemySlot3: Goblin
```

#### 예시 3: 오크 보스 + 미니언 (Stage 4 - Elite)

```
encounterName: "오크 리더와 부하들"

┌──────┬──────┬──────┬──────┐
│ 슬롯0 │ 슬롯1 │ 슬롯2 │ 슬롯3 │
├──────┼──────┼──────┼──────┤
│ 고블린│ 오크 │ 오크 │ 고블린│
└──────┴──────┴──────┴──────┘

enemySlot0: Goblin
enemySlot1: OrcWarrior
enemySlot2: OrcWarrior
enemySlot3: Goblin
```

### 조우 선택 로직

```
1. 플레이어가 스테이지 진입
2. 현재 Stage Number + StageType(Combat/Elite) 확인
3. 해당 EncounterPool 로드
4. Pool의 encounters 리스트에서 랜덤 선택
5. 선택된 EncounterData의 슬롯 정보로 적 생성
```

### 전체 조우 데이터

전체 스테이지(Stage 1-7)의 조우 풀 및 개별 조우 데이터는 별도 문서에 정의되어 있습니다.

**참조**: [EncounterData_Design.md](EncounterData_Design.md)

---

## 🚶 진행 시스템

### 진행 흐름

```
1. 런 시작
   - Stage 1 (일반 전투)로 자동 진입

2. 스테이지 완료
   - 전투: 승리 시 보상 선택
   - 상점/휴식/이벤트: 완료 즉시

3. 다음 스테이지 선택
   - 1-3개 선택지 카드 표시
   - 각 카드: 스테이지 타입, 아이콘, 간단한 정보
   - 보스 직전: 1개만 (필수 선택)

4. 선택 후 즉시 진입
   - 맵 화면 없이 바로 스테이지 시작
   - 전투/상점/휴식/이벤트/보스

5. 반복
   - 보스 클리어 시까지 반복
```

### 보상 선택 (MVP)

```
전투 승리 시:

┌─────────────────────────────────┐
│       전투 승리!                │
├─────────────────────────────────┤
│                                 │
│      [보상 받기]                │
│                                 │
└─────────────────────────────────┘

MVP: 간단한 버튼만
Post-MVP: 블록/유물/회복 등 선택
```

### 스테이지 선택 UI (MVP)

```
스테이지 완료 후:

┌─────────────────────────────────────────┐
│     다음 스테이지를 선택하세요          │
├─────────────────────────────────────────┤
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  │
│  │ ⚔️ 전투 │  │ 🛒 상점 │  │ ⚔️ 전투 │  │
│  │         │  │         │  │         │  │
│  │ Stage 3 │  │ Stage 3 │  │ Stage 3 │  │
│  └─────────┘  └─────────┘  └─────────┘  │
└─────────────────────────────────────────┘

- 1-3개 카드 (가변)
- 클릭하면 즉시 해당 스테이지 진입
- 보스는 1개만 표시
```

### 런 종료 조건

```
승리:
- 보스 스테이지 클리어

패배:
- 플레이어 HP 0

런 종료 시:
- 런 통계 표시 (처치 수, 획득 골드, 진행 층수)
- 메인 메뉴로 이동
```

---

## 🎨 UI/UX

### 스테이지 선택 카드 UI

```
┌─────────────────────────────────────────┐
│     다음 스테이지를 선택하세요          │
├─────────────────────────────────────────┤
│                                         │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  │
│  │ ⚔️      │  │ 🛒      │  │ 💀      │  │
│  │         │  │         │  │         │  │
│  │ 일반    │  │ 상점    │  │ 엘리트  │  │
│  │ 전투    │  │         │  │ 전투    │  │
│  │         │  │         │  │         │  │
│  │ Stage 3 │  │ Stage 3 │  │ Stage 3 │  │
│  └─────────┘  └─────────┘  └─────────┘  │
│                                         │
└─────────────────────────────────────────┘

카드 정보:
- 스테이지 타입 아이콘 (⚔️🛒💤💀❓👹)
- 스테이지 타입 이름
- 단계 번호 (Stage N)
```

### 선택지 개수별 레이아웃

```
1개 선택지 (보스 직전):
┌───────────────┐
│   ┌─────────┐  │
│   │ 👹 보스 │  │
│   └─────────┘  │
└───────────────┘

2개 선택지:
┌─────────────────────┐
│ ┌─────────┐ ┌─────────┐ │
│ │ ⚔️ 전투 │ │ 🛒 상점 │ │
│ └─────────┘ └─────────┘ │
└─────────────────────┘

3개 선택지:
┌─────────────────────────────┐
│ ┌───┐ ┌───┐ ┌───┐ │
│ │⚔️ │ │🛒 │ │⚔️ │ │
│ └───┘ └───┘ └───┘ │
└─────────────────────────────┘
```

### 진행 내역 확인 (Post-MVP)

```
별도 버튼으로 진행 내역 확인 가능:
- 완료한 스테이지 목록
- 선택한 경로 시각화
- 획득한 보상 내역
```

---

## 📦 MVP 범위

### Phase 1: 기본 선택 시스템 (1일)

```
✅ 구현:
- 트리 구조 랜덤 맵 생성 (7단계)
- 6가지 스테이지 타입 (전투/엘리트/상점/휴식/이벤트/보스)
- 스테이지 선택 카드 UI (1-3개 선택지)
- 보상 플레이스홀더 ("보상 받기" 버튼)
- 전투 → 선택 → 전투 플로우

❌ 제외:
- 맵 화면 (향후 히스토리용으로만)
- 실제 보상 선택 시스템
- 상점/휴식/이벤트 실제 콘텐츠
```

### Phase 2: 완전한 통합 (Post-MVP)

```
✅ 구현:
- 실제 보상 선택 시스템 (블록/유물/회복)
- 상점 시스템 (구매)
- 휴식 시스템 (회복/강화)
- 이벤트 시스템 (여러 이벤트)
- 진행 내역 확인 UI
- 런 통계 및 승리/패배 화면

❌ 제외:
- 복잡한 이벤트 (10개+)
- 여러 스테이지/테마
```

---

## 🎮 플레이 예시

### 런 진행 시나리오

```
1. 런 시작
   - 트리 맵 생성
   - Stage 1 (일반 전투)로 자동 진입

2. Stage 1: ⚔️ 전투
   - 슬라임과 전투
   - 승리 → 보상 받기 (MVP: 버튼만)
   - 선택지 표시: [⚔️ 전투 | 🛒 상점 | ⚔️ 전투]

3. 상점 선택 🛒
   - 상점 진입 (MVP: 자동 완료)
   - 선택지 표시: [⚔️ 전투 | 💤 휴식]

4. 휴식 선택 💤
   - 휴식 완료 (MVP: 자동 완료)
   - 선택지 표시: [⚔️ 전투 | 💀 엘리트 | ⚔️ 전투]

5. 엘리트 선택 💀
   - 강화된 오크와 전투
   - 승리 → 보상 받기
   - 선택지 표시: [⚔️ 전투 | ⚔️ 전투]

6. 전투 선택 ⚔️
   - 적 2체와 전투
   - 승리 → 보상 받기
   - 선택지 표시: [👹 보스] (1개만)

7. 보스 진입 👹
   - 오크 보스와 전투
   - 승리 → 런 클리어!
   - 승리 화면 표시
```

---

## 💡 밸런싱 고려사항

### 난이도 곡선

```
Stage 1-2: 쉬움
- 슬라임, 고블린 단일
- 기본 블록으로 클리어 가능

Stage 3-4: 보통
- 다수 적 등장
- 상점/휴식으로 강화 필요

Stage 5-6: 어려움
- 엘리트 등장
- 전략적 블록 운용 필수

Stage 7: 보스
- 보스 전용 패턴
- 충분한 준비 필요
```

### 보상 밸런스

```
전투 승리 시:
- 블록: 50% 확률
- 유물: 30% 확률
- 회복: 20% 확률

엘리트 승리 시:
- 희귀 블록: 40% 확률
- 희귀 유물: 50% 확률
- 회복+골드: 10% 확률
```

---

## 🔮 향후 확장

### 경로 연결 방식 (Slay the Spire 스타일)

```
현재 (MVP): 층별 독립 선택
- 각 층에서 어떤 스테이지든 선택 가능
- 구현 단순

확장: 경로 연결 방식
- 스테이지 간 경로가 그물처럼 연결
- 이전 스테이지 선택이 다음 선택지 제한
- 더 전략적, 구현 복잡
```

### 스테이지 시스템

```
Stage 1: 숲 (7층)
Stage 2: 동굴 (7층)
Stage 3: 성 (7층)
→ 각 스테이지마다 다른 적, 보상, 테마
```

### 난이도 옵션

```
- Normal: 기본
- Hard: 적 강화, 보상 증가
- Ascension: 무한 난이도 시스템
```

---

**작성일**: 2025-12-21
**버전**: 1.0
**담당**: 게임 디자인
