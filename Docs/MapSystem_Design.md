# 맵 시스템 기획 문서

**프로젝트**: MatchBattle
**버전**: 1.0
**작성일**: 2025-12-21
**관련 문서**:
- [GameDesign.md](GameDesign.md) - 게임 전체 설계
- [CombatSystem_Design.md](CombatSystem_Design.md) - 전투 시스템

---

## 📋 목차

1. [시스템 개요](#-시스템-개요)
2. [맵 구조](#-맵-구조)
3. [스테이지 타입](#-스테이지-타입)
4. [진행 시스템](#-진행-시스템)
5. [UI/UX](#-uiux)
6. [MVP 범위](#-mvp-범위)
7. [플레이 예시](#-플레이-예시)
8. [밸런싱 고려사항](#-밸런싱-고려사항)
9. [향후 확장](#-향후-확장)

---

## 🎯 시스템 개요

### 핵심 콘셉트
**층별 스테이지 선택 맵** - 각 층에서 독립적으로 스테이지를 선택하며 진행

```
게임 루프:
전투 승리 → 보상 선택 → 맵에서 다음 스테이지 선택 → 반복 → 보스 전투 → 클리어
```

### 디자인 목표
- 전략적 선택: 어떤 스테이지를 방문할지 결정
- 리스크/리워드: 엘리트 vs 일반 전투, 상점 vs 휴식
- 리플레이성: 매 런마다 다른 맵 레이아웃
- 간결함: MVP에서는 단순한 구조로 시작

---

## 🗺️ 맵 구조

### 기본 구조 (MVP)

```
스테이지(Stage) 기반 진행:

스테이지 표기: N-K (N번째 단계의 K번째 스테이지)

Stage 1:  [1-1] ⚔️ 전투
                ↓
Stage 2:  [2-1] ⚔️ ─ ⚔️ [2-2]
                ↓
Stage 3:      [3-1] ⚔️
                ↓
Stage 4:  [4-1] 🛒 ─ 💤 [4-2]
                ↓
Stage 5:      [5-1] ⚔️
                ↓
Stage 6:  [6-1] ⚔️ ─ 💀 [6-2]
                ↓
Stage 7:      [7-1] 👹 보스
```

### 단계별 스테이지 개수

```
단계   스테이지 수  설명
1      1           시작 전투 (고정)
2-3    1-2         초반 전투
4      2           중간 이벤트 (상점/휴식)
5-6    1-2         후반 전투 (엘리트 등장)
7      1           보스 (고정)

총 7단계, 런 당 약 6-8회 전투
```

### 맵 생성 규칙

```
1. 시작과 끝은 고정
   - Stage 1: 항상 일반 전투
   - Stage 7: 항상 보스

2. 중간 단계 랜덤 생성
   - 각 단계당 1-2개 스테이지
   - 스테이지 타입 확률적 배치

3. 진행 규칙
   - 현재 단계의 스테이지 중 하나 선택
   - 선택 후 다음 단계로 이동
```

---

## 📍 스테이지 타입

### 1. 전투 스테이지 (Combat) ⚔️

```
설명: 적과 전투
보상: 블록/유물/골드/회복 중 선택

일반 전투:
- 적 1-2체
- 표준 보상

출현 확률: 60%
```

### 2. 엘리트 스테이지 (Elite) 💀

```
설명: 강력한 적과 전투
보상: 희귀 블록/유물 획득 확률 증가

엘리트 전투:
- 강화된 적 1체 또는 다수 적
- 더 좋은 보상

출현 확률: 15%
출현 조건: Stage 4 이후
```

### 3. 상점 스테이지 (Shop) 🛒

```
설명: 골드로 아이템 구매

판매 품목:
- 블록 추가 (10-30 골드)
- 유물 구매 (50-100 골드)
- HP 회복 (15 골드 = 10 HP)
- 블록 제거 (20 골드)

출현 확률: 10%
```

### 4. 휴식 스테이지 (Rest) 💤

```
설명: 휴식으로 회복

선택지:
1. 휴식: HP 30% 회복
2. 단련: 랜덤 블록 1개 강화 (공격/방어 +2)

출현 확률: 10%
```

### 5. 이벤트 스테이지 (Event) ❓

```
설명: 랜덤 이벤트 발생

예시 이벤트:
1. 신비한 상자
   - 열기: 랜덤 유물 획득 (50%)
   - 무시: 아무 일 없음

2. 수상한 상인
   - HP 10 지불 → 희귀 블록 획득
   - 거절 → 골드 +10

3. 버려진 제단
   - 기도: 랜덤 버프/디버프
   - 무시: 아무 일 없음

출현 확률: 5%
```

### 6. 보스 스테이지 (Boss) 👹

```
설명: 스테이지 최종 보스

특징:
- 강력한 보스 1체
- 승리 시 스테이지 클리어
- 특별 보상 (희귀 유물 확정)

출현: Stage 7 고정
```

### 스테이지 타입 분포 (MVP)

```
┌──────────┬──────┬─────────────┐
│ 스테이지 │ 확률 │ 층 제한     │
├──────────┼──────┼─────────────┤
│ 전투 ⚔️  │ 60%  │ 없음        │
│ 엘리트 💀│ 15%  │ Stage 4+    │
│ 상점 🛒  │ 10%  │ 없음        │
│ 휴식 💤  │ 10%  │ 없음        │
│ 이벤트 ❓│ 5%   │ 없음        │
└──────────┴──────┴─────────────┘

보스 👹: Stage 7 고정
```

---

## 🚶 진행 시스템

### 맵 진행 흐름

```
1. 맵 표시
   - 현재 위치 강조
   - 이동 가능한 스테이지 표시
   - 방문한 스테이지 흐리게

2. 스테이지 선택
   - 연결된 다음 층 스테이지 중 선택
   - 선택 불가능한 스테이지는 비활성화

3. 스테이지 진입
   - 스테이지 타입에 따른 화면 전환
   - 전투/상점/휴식/이벤트 실행

4. 완료 후
   - 다시 맵 화면으로
   - 다음 층으로 진행
```

### 전투 후 보상 선택

```
전투 승리 시:

┌─────────────────────────────────┐
│         보상을 선택하세요        │
├─────────────────────────────────┤
│ ┌─────────┐ ┌─────────┐ ┌─────────┐ │
│ │ 🪓 도끼  │ │ 🔮 유물  │ │ ❤️ 회복 │ │
│ │ 공격+8  │ │ 공격+2  │ │ HP+20  │ │
│ │ 방어-2  │ │ (패시브)│ │        │ │
│ └─────────┘ └─────────┘ └─────────┘ │
│           [스킵]                   │
└─────────────────────────────────┘

보상 옵션 (3개 중 1개 선택):
1. 블록 추가
2. 유물 획득
3. HP/골드 회복
4. 스킵 (추가 골드)
```

### 런 종료 조건

```
승리:
- 보스 스테이지 클리어

패배:
- 플레이어 HP 0

런 종료 시:
- 런 통계 표시 (처치 수, 획득 골드, 진행 층수)
- 메인 메뉴로 이동
```

---

## 🎨 UI/UX

### 맵 화면 레이아웃

```
┌─────────────────────────────────┐
│  Stage 1     Stage: 3/7        │
├─────────────────────────────────┤
│                                 │
│         👹 [Stage 7]            │
│          ↑                      │
│       💀 ─ ⚔️ [Stage 6]         │
│        ↖ ↗                      │
│         ⚔️ [Stage 5]            │
│          ↑                      │
│       🛒 ─ 💤 [Stage 4]         │
│        ↖ ↗                      │
│    ▶️ ⚔️ [Stage 3] ← 현재 위치   │
│          ↑                      │
│       ⚔️ ─ ⚔️ [Stage 2]         │
│        ↖ ↗                      │
│     ✓ ⚔️ [Stage 1] ← 완료       │
│                                 │
├─────────────────────────────────┤
│ HP: ████████░░ 75/100          │
│ 골드: 💰 45                     │
└─────────────────────────────────┘
```

### 스테이지 상태 표시

```
스테이지 상태:
- 미방문 (이동 가능): 밝은 색 + 테두리
- 미방문 (이동 불가): 흐린 색
- 방문 완료: 체크 표시 + 흐린 색
- 현재 위치: 강조 + 화살표
```

### 스테이지 정보 툴팁

```
스테이지 터치/호버 시:

┌──────────────┐
│ ⚔️ 전투       │
│ 적: 고블린   │
│ 난이도: ★★☆ │
└──────────────┘

┌──────────────┐
│ 🛒 상점       │
│ 블록, 유물   │
│ 구매 가능    │
└──────────────┘
```

---

## 📦 MVP 범위

### Phase 1: 기본 맵 (1-2일)

```
✅ 구현:
- 7층 고정 맵 구조
- 3가지 스테이지 타입 (전투/상점/휴식)
- 층 간 연결 (단순 선형)
- 맵 UI 기본 레이아웃

❌ 제외:
- 랜덤 맵 생성
- 엘리트/이벤트 스테이지
- 분기 경로
```

### Phase 2: 확장 맵 (2-3일)

```
✅ 구현:
- 랜덤 맵 생성
- 분기 경로 (층당 1-2개 스테이지)
- 엘리트 스테이지
- 이벤트 스테이지 (2-3개 이벤트)
- 스테이지 정보 툴팁

❌ 제외:
- 복잡한 분기
- 다양한 이벤트
```

### Phase 3: 풀 버전 (Post-MVP)

```
✅ 구현:
- 다양한 이벤트 (10개+)
- 스테이지 시스템 (여러 맵)
- 특수 스테이지 (보물, 상점 등)
- 맵 테마/비주얼
```

---

## 🎮 플레이 예시

### 런 진행 시나리오

```
1. 런 시작
   - 맵 생성
   - Stage 1 전투 스테이지 자동 선택

2. Stage 1: 전투 ⚔️
   - 슬라임과 전투
   - 승리 → 보상 선택 (도끼 블록 획득)
   - 맵으로 복귀

3. Stage 2: 전투 선택 ⚔️
   - 2개 스테이지 중 왼쪽 선택
   - 고블린과 전투
   - 승리 → 보상 선택 (유물 획득)

4. Stage 3: 전투 ⚔️
   - 적 2체와 전투
   - 승리 → 보상 선택 (HP 회복)

5. Stage 4: 상점 선택 🛒
   - 휴식 대신 상점 선택
   - 포션 블록 구매 (20 골드)
   - 맵으로 복귀

6. Stage 5: 엘리트 선택 💀
   - 강화된 오크와 전투
   - 승리 → 희귀 유물 획득

7. Stage 6: 전투 ⚔️
   - 적 3체와 전투
   - 승리 → 보스 준비

8. Stage 7: 보스 👹
   - 오크 보스와 전투
   - 승리 → 런 클리어!
```

---

## 💡 밸런싱 고려사항

### 난이도 곡선

```
Stage 1-2: 쉬움
- 슬라임, 고블린 단일
- 기본 블록으로 클리어 가능

Stage 3-4: 보통
- 다수 적 등장
- 상점/휴식으로 강화 필요

Stage 5-6: 어려움
- 엘리트 등장
- 전략적 블록 운용 필수

Stage 7: 보스
- 보스 전용 패턴
- 충분한 준비 필요
```

### 보상 밸런스

```
전투 승리 시:
- 블록: 50% 확률
- 유물: 30% 확률
- 회복: 20% 확률

엘리트 승리 시:
- 희귀 블록: 40% 확률
- 희귀 유물: 50% 확률
- 회복+골드: 10% 확률
```

---

## 🔮 향후 확장

### 경로 연결 방식 (Slay the Spire 스타일)

```
현재 (MVP): 층별 독립 선택
- 각 층에서 어떤 스테이지든 선택 가능
- 구현 단순

확장: 경로 연결 방식
- 스테이지 간 경로가 그물처럼 연결
- 이전 스테이지 선택이 다음 선택지 제한
- 더 전략적, 구현 복잡
```

### 스테이지 시스템

```
Stage 1: 숲 (7층)
Stage 2: 동굴 (7층)
Stage 3: 성 (7층)
→ 각 스테이지마다 다른 적, 보상, 테마
```

### 난이도 옵션

```
- Normal: 기본
- Hard: 적 강화, 보상 증가
- Ascension: 무한 난이도 시스템
```

---

**작성일**: 2025-12-21
**버전**: 1.0
**담당**: 게임 디자인
